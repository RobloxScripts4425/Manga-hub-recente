-- Carregar a biblioteca Orion
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Orion/main/source"))()

-- Criar a interface
local Window = OrionLib:MakeWindow({Name = "Manga Hub 4.2.1", HidePremium = true})

-- Criar a aba de Jogador
local PlayerTab = Window:MakeTab({
    Name = "Jogador",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Criar a aba de Troll
local TrollTab = Window:MakeTab({
    Name = "Troll",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- Variáveis para controle de fling
local flingConnection
local flingSpeed = 1945
local teleportDistance = 120
local teleportDelay = 0.1
local playerName
local flingTarget
local originalJumpPower
local originalWalkSpeed

-- Função para iniciar o fling
local function startFling(playerIdentifier)
    if playerIdentifier == "" then
        print("Por favor, insira o nick do jogador.")
        return
    end

    local targetPlayer = game.Players:FindFirstChild(playerIdentifier)

    if not targetPlayer then
        for _, p in ipairs(game.Players:GetPlayers()) do
            if p.DisplayName:lower():sub(1, #playerIdentifier:lower()) == playerIdentifier:lower() then
                targetPlayer = p
                break
            end
        end
    end

    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local localPlayer = game.Players.LocalPlayer
        local localHRP = localPlayer.Character:FindFirstChild("HumanoidRootPart")
        local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
        local humanoid = targetPlayer.Character:FindFirstChildOfClass("Humanoid")

        if localHRP and targetHRP and humanoid then
            local function fling()
                if humanoid.MoveDirection.Magnitude > 0 or humanoid.Jump then
                    local offset = targetHRP.CFrame.LookVector * -2.5
                    local positionBehind = targetHRP.Position + offset
                    localHRP.CFrame = CFrame.new(positionBehind, targetHRP.Position)
                    localHRP.Velocity = (targetHRP.Position - localHRP.Position).unit * flingSpeed
                end
            end

            local function teleport()
                local lastTeleportTime = tick()
                while targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") do
                    if humanoid.MoveDirection.Magnitude > 0 or humanoid.Jump then
                        local currentTime = tick()
                        if currentTime - lastTeleportTime >= teleportDelay then
                            local targetPosition = targetHRP.Position
                            localHRP.CFrame = CFrame.new(targetPosition + targetHRP.CFrame.LookVector * -teleportDistance, targetPosition)
                            wait(0.1)
                            localHRP.CFrame = CFrame.new(targetPosition + targetHRP.CFrame.LookVector * teleportDistance, targetPosition)
                            lastTeleportTime = currentTime
                        end
                        wait(0.1)
                    else
                        localHRP.CFrame = CFrame.new(targetHRP.Position + targetHRP.CFrame.LookVector * -2.5)
                        wait(0.1)
                    end
                end
            end

            flingTarget = targetPlayer.Character
            flingConnection = game:GetService("RunService").Heartbeat:Connect(function()
                if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    fling()
                    teleport()
                end
            end)
            print("Fling iniciado no jogador: " .. targetPlayer.DisplayName)
        else
            print("HumanoidRootPart do jogador alvo não encontrado.")
        end
    else
        print("Jogador alvo não encontrado.")
    end
end

-- Função para parar o fling
local function stopFling()
    if flingConnection then
        flingConnection:Disconnect()
        flingConnection = nil
        print("Fling parado.")
    end
end

-- Função para prevenir que o jogador se sente
local function preventSitting()
    local player = game.Players.LocalPlayer
    if player and player.Character and player.Character:FindFirstChild("Humanoid") then
        local humanoid = player.Character.Humanoid
        humanoid.SittingChanged:Connect(function(isSitting)
            if isSitting then
                humanoid:ChangeState(Enum.HumanoidStateType.Seated)
                print("Anti-Sit ativado. Sentar foi evitado.")
            end
        end)
    end
end

-- Adicionar controles na aba Jogador
PlayerTab:AddTextbox({
    Name = "Nome do Jogador",
    Callback = function(value)
        playerName = value
    end    
})

PlayerTab:AddButton({
    Name = "Iniciar Fling",
    Callback = function()
        if playerName and playerName ~= "" then
            startFling(playerName)
            preventSitting() -- Ativar a prevenção de sentar quando o fling está ativado
        else
            print("Por favor, insira o nome do jogador.")
        end
    end    
})

PlayerTab:AddButton({
    Name = "Parar Fling",
    Callback = function()
        stopFling()
    end    
})

-- Adicionar botão +30 Pulo
PlayerTab:AddButton({
    Name = "+30 Pulo",
    Callback = function()
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character and character:FindFirstChildOfClass("Humanoid") then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if not originalJumpPower then
                originalJumpPower = humanoid.JumpPower
            end
            humanoid.JumpPower = humanoid.JumpPower + 30
            print("Pulo aumentado em 30.")
        else
            print("Humanoide não encontrado no personagem.")
        end
    end    
})

-- Adicionar botão Pulo e Velocidade Normal
PlayerTab:AddButton({
    Name = "Pulo e Velocidade Normal",
    Callback = function()
        local player = game.Players.LocalPlayer
        local character = player.Character
        if character and character:FindFirstChildOfClass("Humanoid") then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if originalJumpPower then
                humanoid.JumpPower = originalJumpPower
                originalJumpPower = nil
                print("Pulo e velocidade restaurados ao normal.")
            else
                print("Nenhuma alteração de pulo encontrada.")
            end
        else
            print("Humanoide não encontrado no personagem.")
        end
    end    
})

-- Adicionar botão Tp Tool
PlayerTab:AddButton({
    Name = "Tp Tool",
    Callback = function()
        local player = game.Players.LocalPlayer
        local backpack = player.Backpack

        -- Criar o item tptool
        local tpTool = Instance.new("Tool")
        tpTool.Name = "Teleport Tool"
        tpTool.RequiresHandle = true
        tpTool.CanBeDropped = false
        tpTool.Parent = backpack

        local handle = Instance.new("Part")
        handle.Name = "Handle"
        handle.Size = Vector3.new(1, 1, 1)
        handle.Parent = tpTool

        tpTool.Activated:Connect(function()
            -- Teleporte o jogador para a posição do mouse
            local mouse = player:GetMouse()
            local targetPosition = mouse.Hit.Position
            player.Character:SetPrimaryPartCFrame(CFrame.new(targetPosition))
            print("Jogador teleportado para a posição do mouse.")
        end)

        print("Tp Tool adicionada ao inventário.")
    end    
})

-- Atualizar janela
OrionLib:Init()
